<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8">

        <script type="text/javascript" src="js/libs/glMatrix-0.9.5.min.js"></script>
        <script id="shader-fs" type="x-shader/x-fragment">
            precision mediump float;

            varying lowp vec4 vColor;

            void main(void) {
                gl_FragColor = vColor;
            }
        </script>

        <script id="shader-vs" type="x-shader/x-vertex">
            attribute vec3 aVertexPosition;
            attribute vec4 aVertexColor;

            uniform mat4 uMVMatrix;
            uniform mat4 uPMatrix;

            varying lowp vec4 vColor;

            void main(void) {
                gl_Position = uPMatrix * uMVMatrix * vec4(aVertexPosition, 1.0);
                vColor = aVertexColor;
            }
        </script>

        <!-- Stop IE from using Compatibility Mode -->
        <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">

        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <link rel="stylesheet" type="text/css" href="css/mobile.css" media="screen, handheld" />
        <link rel="stylesheet" type="text/css" href="css/style.css" media="screen and (min-width: 40.5em)" />
        <link rel="stylesheet" href="http://fonts.googleapis.com/css?family=Roboto:regular,medium,thin,italic,mediumitalic">
        <title>VoteBrian</title>
    </head>
    <body>
        <!-- Canvas background -->
        <canvas id="bg" width="100%" height="100%"></canvas>

        <!-- Start Content -->
        <div id="header">
            <div id="name">VoteBrian</div>
        </div>

        <div id="content">
            <div class="section">
                <div class="section_title">Hello</div>
                <hr>
                <div class="subsection">
                    <div class="clear"></div>
                    <div class="subsection_content">Sorry if this place is a mess. I recently switched hosting companies, and I decided to take the opportunity to rebuild everything from scratch. Below are some things you might find interesting.</div>
                </div> <!-- subsection -->
            </div> <!-- section -->

            <div class="section">
                <div class="section_title">Projects</div>
                <hr>
                <div class="subsection">
                    <div class="subsection_title">March Madness Suicide Pool</div>
                    <div class="clear"></div>
                    <div class="subsection_item">Every year, my buddy and I run the greatest of all March Madness "office" <a href="http://ncaa.votebrian.net">pools</a>. The pool has been going strong for 5 years and has gotten bigger each year. It was written in an unholy mix of html, php, sql, and javascript. While it has served us well, I think it's time for a rewrite.</div>
                </div> <!-- subsection -->

                <div class="subsection">
                    <div class="subsection_title">Android Development</div>
                    <div class="clear"></div>
                    <div class="subsection_item">I've got a couple apps on the Google Play Store.  <a href="https://play.google.com/store/apps/developer?id=VoteBrian">Go</a> check them out.</div>
                </div> <!-- subsection -->

                <div class="subsection">
                    <div class="subsection_title">Code Samples</div>
                    <div class="clear"></div>
                    <div class="subsection_item">I'm working on moving everything to github and making most of it public.  There's not much <a href="https://github.com/VoteBrian">there</a> right now, but I'm slowly building it up.</div>
                </div> <!-- subsection -->
            </div> <!-- section -->

            <div class="section">
                <div class="section_title">Resume</div>
                <hr>
                <div class="subsection">
                    <div class="clear"></div>
                    <div class="subsection_content">If you do something cool, you should consider offering me a job.  <a href="http://www.votebrian.net/resume">Here's</a> why.</div>
                </div> <!-- subsection -->
            </div> <!-- section -->
        </div> <!-- content -->


        <!-- Grab Google CDN's jQuery, with a protocol relative URL; fall back to local if offline -->
        <script src="//ajax.googleapis.com/ajax/libs/jquery/1.6.2/jquery.min.js"></script>
        <script>window.jQuery || document.write('<script src="js/libs/jquery-1.6.2.min.js"><\/script>')</script>

        <!-- Import my scripts -->
        <!--
        <script defer src="js/script.js"></script>
        -->

        <script type="text/javascript">

            $(document).ready(function() {
                drawBG();
            });

            $(window).resize(function() {
                drawBG();
            });

            var mNoGL = false;
            var mCtx;
            var gl;
            var mCanvas;
            var mShaderProgram;
            var vectorBuffer;
            var colorBuffer;
            var mWidth;
            var mHeight;

            var mNumCubes = 10;

            var mvMatrix = mat4.create();
            var pMatrix = mat4.create();

            var cubes = [];

            var mvMatrixStack = [];

            function drawBG() {
                mWidth = window.innerWidth;
                mHeight = window.innerHeight;
                drawSquares();
            }

            function drawSquares() {
                mCanvas = document.getElementById('bg');
                if (mCanvas.getContext) {

                    var colors = new Array();
                    colors[0] = "#615046";
                    colors[1] = "#44503A";
                    colors[2] = "#9BA29A";
                    colors[3] = "#39455F";
                    colors[4] = "#44474E";

                    bgClr = "#F4F4F4";

                    initGL();
                    initShaders();
                    initBuffers();
                    initCubes();

                    gl.clearColor(0.0, 0.0, 0.0, 1.0);
                    gl.enable(gl.DEPTH_TEST);
                    gl.depthFunc(gl.LESS);
                    //gl.frontFace(gl.CW);
                    //gl.cullFace(gl.BACK);

                    draw();
                }
            }

            function initGL() {
                try{
                    gl = mCanvas.getContext('experimental-webgl')

                    gl.canvas.width = mWidth;
                    gl.canvas.height = mHeight;

                    gl.viewportWidth = mWidth;
                    gl.viewportHeight = mHeight;
                } catch(e) {
                }

                if(!gl) {
                    mNoGL = true;
                    alert("Your browser doesn't support WebGL.  :(");
                }
            }

            function initShaders() {
                var fragmentShader = getShader(gl, "shader-fs");
                var vertexShader = getShader(gl, "shader-vs");

                mShaderProgram = gl.createProgram();
                gl.attachShader(mShaderProgram, vertexShader);
                gl.attachShader(mShaderProgram, fragmentShader);
                gl.linkProgram(mShaderProgram);

                if (!gl.getProgramParameter(mShaderProgram, gl.LINK_STATUS)) {
                    alert("Could not initialise shaders");
                }

                gl.useProgram(mShaderProgram);

                mShaderProgram.vertexPositionAttribute = gl.getAttribLocation(mShaderProgram, "aVertexPosition");
                gl.enableVertexAttribArray(mShaderProgram.vertexPositionAttribute);

                mShaderProgram.vertexColorAttribute = gl.getAttribLocation(mShaderProgram, "aVertexColor");
                gl.enableVertexAttribArray(mShaderProgram.vertexColorAttribute);

                mShaderProgram.pMatrixUniform = gl.getUniformLocation(mShaderProgram, "uPMatrix");
                mShaderProgram.mvMatrixUniform = gl.getUniformLocation(mShaderProgram, "uMVMatrix");
            }

            function getShader(gl, id) {
                var shaderScript = document.getElementById(id);
                if (!shaderScript) {
                    return null;
                }

                var str = "";
                var k = shaderScript.firstChild;
                while (k) {
                    if (k.nodeType == 3) {
                        str += k.textContent;
                    }
                    k = k.nextSibling;
                }

                var shader;
                if (shaderScript.type == "x-shader/x-fragment") {
                    shader = gl.createShader(gl.FRAGMENT_SHADER);
                } else if (shaderScript.type == "x-shader/x-vertex") {
                    shader = gl.createShader(gl.VERTEX_SHADER);
                } else {
                    return null;
                }

                gl.shaderSource(shader, str);
                gl.compileShader(shader);

                if (!gl.getShaderParameter(shader, gl.COMPILE_STATUS)) {
                    alert(gl.getShaderInfoLog(shader));
                    return null;
                }

                return shader;
            }

            function Cube(centerX, centerY, centerZ) {
                this.centX = centerX;
                this.centY = centerY;
                this.centZ = centerZ;
            }

            Cube.prototype.draw = function () {
                mvPushMatrix();

                mat4.identity(mvMatrix);

                mat4.translate(mvMatrix, [this.centX, this.centY, this.centZ]);

                gl.bindBuffer(gl.ARRAY_BUFFER, vectorBuffer);
                gl.vertexAttribPointer(mShaderProgram.vertexPositionAttribute, vectorBuffer.itemSize, gl.FLOAT, false, 0, 0);

                gl.bindBuffer(gl.ARRAY_BUFFER, colorBuffer);
                gl.vertexAttribPointer(mShaderProgram.vertexColorAttribute, colorBuffer.itemSize, gl.FLOAT, false, 0, 0);

                setMatrixUniforms();

                gl.drawArrays(gl.TRIANGLES, 0, vectorBuffer.numItems);

                mvPopMatrix();
            }

            function initCubes() {
                for(var i=0; i < mNumCubes; i++) {
                    cubes.push( new Cube(-9.0 + (2*i), 2, -11) );
                }
            }

            function initBuffers() {
                var vertices = [
                    -0.5,  0.5,  0.0,  // front
                     0.5,  0.5,  0.0,
                    -0.5, -0.5,  0.0,

                     0.5, -0.5,  0.0,
                    -0.5, -0.5,  0.0,
                     0.5,  0.5,  0.0,

                     0.5,  0.5, -0.5,  // back
                    -0.5,  0.5, -0.5,
                    -0.5, -0.5, -0.5,

                     0.5, -0.5, -0.5,
                     0.5,  0.5, -0.5,
                    -0.5, -0.5, -0.5,

                    -0.5,  0.5,  0.0,  // top
                     0.5,  0.5,  0.0,
                     0.5,  0.5, -0.5,

                    -0.5,  0.5, -0.5,
                    -0.5,  0.5,  0.0,
                     0.5,  0.5, -0.5,

                     0.5,  0.5,  0.0,  // right
                     0.5, -0.5,  0.0,
                     0.5, -0.5, -0.5,

                     0.5,  0.5, -0.5,
                     0.5,  0.5,  0.0,
                     0.5, -0.5, -0.5,

                     0.5, -0.5,  0.0,  // bottom
                    -0.5, -0.5,  0.0,
                    -0.5, -0.5, -0.5,

                     0.5, -0.5, -0.5,
                     0.5, -0.5,  0.0,
                    -0.5, -0.5, -0.5,

                    -0.5, -0.5,  0.0,  // left
                    -0.5,  0.5,  0.0,
                    -0.5,  0.5, -0.5,

                    -0.5, -0.5, -0.5,
                    -0.5, -0.5,  0.0,
                    -0.5,  0.5, -0.5

                ];
                vectorBuffer = gl.createBuffer();
                gl.bindBuffer(gl.ARRAY_BUFFER, vectorBuffer);
                gl.bufferData(gl.ARRAY_BUFFER, new Float32Array(vertices), gl.STATIC_DRAW);

                vectorBuffer.itemSize = 3;
                vectorBuffer.numItems = 30;


                var dark_blue = [
                     0.3, 0.7, 0.83, 0.0,  // front
                     0.3, 0.7, 0.83, 0.0,
                     0.3, 0.7, 0.83, 0.0,

                     0.3, 0.7, 0.83, 0.0,
                     0.3, 0.7, 0.83, 0.0,
                     0.3, 0.7, 0.83, 0.0,

                     0.83, 0.7, 0.3, 1.0,  // back
                     0.83, 0.7, 0.3, 1.0,
                     0.83, 0.7, 0.3, 1.0,

                     0.83, 0.7, 0.3, 1.0,
                     0.83, 0.7, 0.3, 1.0,
                     0.83, 0.7, 0.3, 1.0,

                     1.0, 1.0, 1.0, 1.0,  // top
                     1.0, 1.0, 1.0, 1.0,
                     1.0, 1.0, 1.0, 1.0,

                     1.0, 1.0, 1.0, 1.0,
                     1.0, 1.0, 1.0, 1.0,
                     1.0, 1.0, 1.0, 1.0,

                     1.0, 1.0, 1.0, 1.0,  // right
                     1.0, 1.0, 1.0, 1.0,
                     1.0, 1.0, 1.0, 1.0,

                     1.0, 1.0, 1.0, 1.0,
                     1.0, 1.0, 1.0, 1.0,
                     1.0, 1.0, 1.0, 1.0,

                     1.0, 1.0, 1.0, 0.0,  // bottom
                     1.0, 1.0, 1.0, 0.0,
                     1.0, 1.0, 1.0, 0.0,

                     1.0, 1.0, 1.0, 0.0,
                     1.0, 1.0, 1.0, 0.0,
                     1.0, 1.0, 1.0, 0.0,

                     1.0, 1.0, 1.0, 1.0,  // left
                     1.0, 1.0, 1.0, 1.0,
                     1.0, 1.0, 1.0, 1.0,

                     1.0, 1.0, 1.0, 1.0,
                     1.0, 1.0, 1.0, 1.0,
                     1.0, 1.0, 1.0, 1.0
                ];
                colorBuffer = gl.createBuffer();
                gl.bindBuffer(gl.ARRAY_BUFFER, colorBuffer);
                gl.bufferData(gl.ARRAY_BUFFER, new Float32Array(dark_blue), gl.STATIC_DRAW);

                colorBuffer.itemSize = 4;
                colorBuffer.numItems = 30;
            }

            function draw() {
                gl.viewport(0, 0, gl.viewportWidth, gl.viewportHeight);
                gl.clear(gl.COLOR_BUFFER_BIT | gl.DEPTH_BUFFER_BIT);

                var w = gl.viewportWidth;
                var h = gl.viewportHeight;

                fovX = 90;
                fovY = fovX * h / w;

                mat4.identity(mvMatrix);
                mat4.perspective(fovY, w/h, 0.1, 40.0, pMatrix);

                gl.blendFunc(gl.SRC_ALPHA, gl.ONE_MINUS_SRC_ALPHA);
                gl.enable(gl.BLEND);

                for(var i=0; i < mNumCubes; i++) {
                    cubes[i].draw();
                }
            }

            function setMatrixUniforms() {
                gl.uniformMatrix4fv(mShaderProgram.pMatrixUniform, false, pMatrix);
                gl.uniformMatrix4fv(mShaderProgram.mvMatrixUniform, false, mvMatrix);
            }

            function drawCircles() {
                var bgCanvas = document.getElementById('bg');
                if(bgCanvas.getContext) {
                    var ctx = bgCanvas.getContext('2d');

                    var colors = new Array();
                    colors[0] = "#615046";
                    colors[1] = "#44503A";
                    colors[2] = "#9BA29A";
                    colors[3] = "#39455F";
                    colors[4] = "#44474E";

                    bgClr = "#F4F4F4";

                    w = window.innerWidth;
                    h = window.innerHeight;

                    ctx.canvas.width = w;
                    ctx.canvas.height = h;

                    ctx.fillStyle = "rgba(244, 244, 244, 1.0)";
                    ctx.fillRect(0, 0, w, h);

                    cntX = 0;
                    cntY = 0;
                    rad = 0;

                    for(x=0; x < 50; x++) {
                        prvX = cntX;
                        prvY = cntY;
                        prvR = rad;

                        if(Math.floor(Math.random()*2)) {
                            signX = 1;
                        } else signX = -1;

                        if(Math.floor(Math.random()*2)) {
                            signY = 1;
                        } else signY = -1;

                        rad = Math.floor(Math.random()*150)+20;
                        maxDev = rad+prvR;

                        cntX = prvX + (signX * Math.floor(Math.random()*maxDev));
                        if(cntX < 0) {
                            cntX = 0;
                        } else if(cntX > w) {
                            cntX = w;
                        }
                        cntY = prvY + (signY * Math.floor(Math.random()*maxDev));
                        if(cntY < 0) {
                            cntY = 0;
                        } else if(cntY > h) {
                            cntY = h;
                        }
                        clr = colors[Math.floor(Math.random()*5)];

                        ctx.beginPath();
                        ctx.arc(cntX, cntY, rad, 0, 2* Math.PI, false);
                        ctx.fillStyle=clr;
                        ctx.fill();
                        ctx.lineWidth=5;
                        ctx.strokeStyle=bgClr;
                        ctx.stroke();
                    }
                }
            }

            function mvPushMatrix() {
                var copy = mat4.create();
                mat4.set(mvMatrix, copy);
                mvMatrixStack.push(copy);
            }

            function mvPopMatrix() {
                if (mvMatrixStack.length == 0) {
                    throw "Invalid popMatrix!";
                }
                mvMatrix = mvMatrixStack.pop();
            }
        </script>

    </body>
</html>